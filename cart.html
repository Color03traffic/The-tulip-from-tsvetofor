<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Корзина — Тюльпан03</title>
  <style>
    :root{
      --bg:#f7c1d9; 
      --card:#ffffff;
      --text:#111;
      --muted:#666;
      --brand:#E33478;
      --radius:16px;
      --stroke:#e5e7eb;
    }

    body{
      margin:0;
      font-family:system-ui, sans-serif;
      background:var(--bg);
      color:var(--text);
    }

    .container{
      max-width:1100px;
      margin:0 auto;
      padding:16px;
    }

    h1{
      text-align:center;
      margin-bottom:20px;
    }

    .card{
      background:var(--card);
      border-radius:var(--radius);
      padding:20px;
      border:1px solid var(--stroke);
      margin-bottom:20px;
    }

    .back-btn{
      display:inline-block;
      background:var(--brand);
      color:#fff;
      padding:10px 18px;
      border-radius:12px;
      text-decoration:none;
      font-weight:600;
    }

    .clear-btn{
      display:inline-block;
      background:#ff4d4d;
      color:#fff;
      padding:10px 18px;
      border-radius:12px;
      text-decoration:none;
      font-weight:600;
      margin-left:10px;
      cursor:pointer;
    }

    table{
      width:100%;
      border-collapse:collapse;
      margin-top:10px;
    }

    table td, table th{
      padding:10px;
      border-bottom:1px solid var(--stroke);
    }

    .btn{
      padding:10px 16px;
      border-radius:12px;
      border:none;
      cursor:pointer;
      font-weight:600;
      color:#fff;
      margin-right:10px;
    }

    .whatsapp{ background:#25D366; }
    .telegram{ background:#229ED9; }

    input.qty{
      width:70px;
      padding:6px;
      text-align:center;
      border-radius:10px;
      border:1px solid #ccc;
    }

    /* Подсветка некорректного количества */
    input.qty.invalid{
      border:2px solid red !important;
      background:#ffe6e6 !important;
    }
  </style>
</head>
<body>

<div class="container">

  <a href="catalog.html" class="back-btn">← Вернуться в каталог</a>

  <h1>Корзина</h1>

  <div class="card">
    <table id="cartTable">
      <thead>
        <tr>
          <th>Товар</th>
          <th>Тип</th>
          <th>Количество</th>
          <th>Цена</th>
          <th>Сумма</th>
          <th></th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <h2>Итого: <span id="totalPrice">0 ₽</span></h2>

    <button class="btn whatsapp" onclick="sendWhatsApp()">Отправить в WhatsApp</button>
    <button class="btn telegram" onclick="sendTelegram()">Отправить в Telegram</button>
    <button class="clear-btn" onclick="clearCart()">Очистить корзину</button>
  </div>

</div>

<script>
/*
  Ожидаемый формат cart в localStorage:
  {
    "yellow": { name:"Жёлтый", type:"Гладкий", qty: 40, price: 99 },
    "mahrovyi": { name:"Махровый розовый", type:"Махровый", qty: 60, price: 109 }
  }
  Ключ: "cart"
*/

// Загрузка корзины
function loadCart(){
  const cart = JSON.parse(localStorage.getItem('cart') || '{}');
  const tbody = document.querySelector('#cartTable tbody');
  tbody.innerHTML = '';
  let total = 0;

  const ids = Object.keys(cart);
  if(!ids.length){
    tbody.innerHTML = '<tr><td colspan="6">Корзина пуста. Добавьте тюльпаны в каталоге.</td></tr>';
    document.getElementById('totalPrice').innerText = '0 ₽';
    return;
  }

  ids.forEach(id => {
    const item = cart[id];
    const sum = item.price * item.qty;
    total += sum;

    tbody.innerHTML += `
      <tr>
        <td>${item.name}</td>
        <td>${item.type || ""}</td>
        <td>
          <input
            type="number"
            class="qty"
            min="20"
            step="20"
            value="${item.qty}"
            oninput="highlightInvalid(this)"
            onblur="updateQty('${id}', this.value)"
          >
        </td>
        <td>${item.price} ₽</td>
        <td>${sum.toLocaleString('ru-RU')} ₽</td>
        <td><a href="#" onclick="removeItem('${id}');return false;">Удалить</a></td>
      </tr>
    `;
  });

  document.getElementById('totalPrice').innerText = total.toLocaleString('ru-RU') + ' ₽';
}

// Подсветка некорректного ввода
function highlightInvalid(input){
  const v = parseInt(input.value);
  if (!v || v < 20 || v % 20 !== 0){
    input.classList.add('invalid');
  } else {
    input.classList.remove('invalid');
  }
}

// Обновление количества (кратно 20)
function updateQty(id, qty){
  let q = parseInt(qty);

  if (!q || q < 20) q = 20;

  // округляем до ближайших 20
  if (q % 20 !== 0){
    q = Math.round(q / 20) * 20;
  }
  if (q < 20) q = 20;

  const cart = JSON.parse(localStorage.getItem('cart') || '{}');
  if (!cart[id]) return;

  cart[id].qty = q;
  localStorage.setItem('cart', JSON.stringify(cart));

  // снимаем подсветку и перерисовываем
  loadCart();
}

// Удаление одной позиции
function removeItem(id){
  const cart = JSON.parse(localStorage.getItem('cart') || '{}');
  delete cart[id];
  localStorage.setItem('cart', JSON.stringify(cart));
  loadCart();
}

// Очистить корзину полностью
function clearCart(){
  localStorage.removeItem('cart');
  loadCart();
}

// Сбор текста заказа
function buildMessage(){
  const cart = JSON.parse(localStorage.getItem('cart') || '{}');
  const ids = Object.keys(cart);
  if(!ids.length) return 'Корзина пуста.';

  let text = 'Заказ тюльпанов:\n\n';
  let total = 0;

  ids.forEach(id => {
    const item = cart[id];
    const sum = item.price * item.qty;
    total += sum;
    text += `${item.name} — ${item.qty} шт × ${item.price} ₽ = ${sum.toLocaleString('ru-RU')} ₽\n`;
  });

  text += `\nИтого: ${total.toLocaleString('ru-RU')} ₽`;
  return text;
}

// Отправка WhatsApp
function sendWhatsApp(){
  const msg = buildMessage();
  const url = 'https://wa.me/79148416115?text=' + encodeURIComponent(msg);
  window.open(url, '_blank');
}

// Отправка Telegram
function sendTelegram(){
  const msg = buildMessage();
  // можно заменить на конкретный username/чат, если используешь deeplink
  const url = 'https://t.me/share/url?url=' + encodeURIComponent('tulpan03') +
              '&text=' + encodeURIComponent(msg);
  window.open(url, '_blank');
}

// инициализация
loadCart();
</script>

</body>
</html>


<div class="container">

  <a href="catalog.html" class="back-btn">← Вернуться в каталог</a>

  <h1>Корзина</h1>

  <div class="card">
    <table id="cartTable">
      <thead>
        <tr>
          <th>Товар</th>
          <th>Тип</th>
          <th>Количество</th>
          <th>Цена</th>
          <th>Сумма</th>
          <th></th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <h2>Итого: <span id="totalPrice">0 ₽</span></h2>

    <button class="btn whatsapp" onclick="sendWhatsApp()">Отправить в WhatsApp</button>
    <button class="btn telegram" onclick="sendTelegram()">Отправить в Telegram</button>
    <button class="clear-btn" onclick="clearCart()">Очистить корзину</button>
  </div>

</div>


<script>

// ==============================================
// ЗАГРУЗКА КОРЗИНЫ
// ==============================================

function loadCart(){
  const cart = JSON.parse(localStorage.getItem('cart') || '{}');
  const tbody = document.querySelector('#cartTable tbody');
  tbody.innerHTML = '';
  let total = 0;

  for (const id in cart){
    const item = cart[id];
    const sum = item.price * item.qty;
    total += sum;

    tbody.innerHTML += `
      <tr>
        <td>${item.name}</td>
        <td>${item.type}</td>
        <td>
          <input type="number" class="qty" min="20" step="20" value="${item.qty}" onchange="updateQty('${id}', this.value)">
        </td>
        <td>${item.price} ₽</td>
        <td>${sum} ₽</td>
        <td><a href="#" onclick="removeItem('${id}')">Удалить</a></td>
      </tr>
    `;
  }

  document.getElementById('totalPrice').innerText = total + " ₽";
}

loadCart();

// ==============================================
// ОБНОВЛЕНИЕ КОЛИЧЕСТВА
// ==============================================

function updateQty(id, qty){
  let q = parseInt(qty);

  // Минимум 20
  if (q < 20) q = 20;

  // Округление до ближайших 20
  if (q % 20 !== 0){
    q = Math.round(q / 20) * 20;
  }

  // Но если получилось 0 — ставим 20
  if (q < 20) q = 20;

  // Обновляем cart
  const cart = JSON.parse(localStorage.getItem('cart') || '{}');
  cart[id].qty = q;
  localStorage.setItem('cart', JSON.stringify(cart));

  // Перерисовываем
  loadCart();
}

}

// ==============================================
// УДАЛЕНИЕ ОДНОГО ТОВАРА
// ==============================================

function removeItem(id){
  const cart = JSON.parse(localStorage.getItem('cart') || '{}');
  delete cart[id];
  localStorage.setItem('cart', JSON.stringify(cart));
  loadCart();
}

// ==============================================
// ОЧИСТИТЬ ВСЮ КОРЗИНУ
// ==============================================

function clearCart(){
  localStorage.removeItem('cart');
  loadCart();
}

// ==============================================
// ОТПРАВКА WHATSAPP
// ==============================================

function sendWhatsApp(){
  const msg = buildMessage();
  window.open(`https://wa.me/79148416115?text=${encodeURIComponent(msg)}`, "_blank");
}

// ==============================================
// ОТПРАВКА TELEGRAM
// ==============================================

function sendTelegram(){
  const msg = buildMessage();
  window.open(`tg://msg?text=${encodeURIComponent(msg)}`, "_blank");
}

// ==============================================
// СБОР СООБЩЕНИЯ
// ==============================================

function buildMessage(){
  const cart = JSON.parse(localStorage.getItem('cart') || '{}');
  let text = "Заказ тюльпанов:\n";

  for (const id in cart){
    const item = cart[id];
    text += `${item.name} — ${item.qty} шт по ${item.price} ₽\n`;
  }

  return text;
}

</script>

</body>
</html>
