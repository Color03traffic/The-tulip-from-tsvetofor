<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Корзина — Тюльпан03</title>

  <style>
    :root{
      --bg:#f7b3d0; /* мягкий розовый фон */
      --white:#ffffff;
      --text:#222;
      --muted:#666;
      --brand:#e33474;
      --radius:18px;
    }

    *{box-sizing:border-box;}
    body{
      margin:0;
      background:var(--bg);
      font-family:system-ui,Roboto,Arial,sans-serif;
      color:var(--text);
    }

    .container{
      max-width:900px;
      margin:40px auto;
      padding:20px;
      background:var(--white);
      border-radius:var(--radius);
    }

    h1{
      margin-top:0;
      font-size:30px;
      font-weight:700;
    }

    table{
      width:100%;
      border-collapse:collapse;
      margin-top:20px;
    }

    th,td{
      padding:12px 10px;
      border-bottom:1px solid #ddd;
      text-align:left;
    }

    .qtyBox{
      display:flex;
      align-items:center;
      gap:6px;
    }

    .qtyBox button{
      width:32px;
      height:32px;
      border-radius:8px;
      border:1px solid #ccc;
      background:#fff;
      cursor:pointer;
      font-size:18px;
    }

    .qtyBox input{
      width:60px;
      text-align:center;
      padding:6px;
      border-radius:8px;
      border:1px solid #ccc;
    }

    .btn{
      padding:12px 20px;
      background:var(--brand);
      border-radius:10px;
      color:#fff;
      font-weight:600;
      border:none;
      cursor:pointer;
      display:inline-block;
      margin-top:20px;
      text-align:center;
    }

    .btn:hover{
      opacity:0.9;
    }

    .btnGreen{
      background:#25D366;
      border:none;
    }

    .btnBlue{
      background:#229ED9;
      border:none;
    }

    .btnSecondary{
      background:#fff;
      border:2px solid var(--brand);
      color:var(--brand);
      margin-right:12px;
    }

    .totalBox{
      margin-top:20px;
      font-size:22px;
      font-weight:700;
    }

    @media(max-width:600px){
      table,thead,tbody,tr,td,th{display:block;}
      td{border:none;}
      tr{margin-bottom:20px;border-bottom:1px solid #ddd;padding-bottom:10px;}
    }
  </style>
</head>

<body>

<div class="container">
  <h1>Корзина</h1>

  <p class="muted">Количество кратно 20 шт. Нажмите «+» или «−» для изменения количества.</p>

  <table id="cartTable">
    <thead>
      <tr>
        <th>Товар</th>
        <th>Цена</th>
        <th>Количество</th>
        <th>Сумма</th>
      </tr>
    </thead>
    <tbody id="cartBody"></tbody>
  </table>

  <div class="totalBox">Итого: <span id="cartTotal">0 ₽</span></div>

  <!-- Кнопки -->
  <div style="margin-top:25px;">
    <a href="/catalog.html" class="btn btnSecondary">Вернуться в каталог</a>
    <button class="btn" onclick="clearCart()">Очистить корзину</button>
  </div>

  <div style="margin-top:25px;">
    <button class="btn btnGreen" onclick="sendWhatsApp()">Отправить в WhatsApp</button>
    <button class="btn btnBlue" onclick="sendTelegram()">Отправить в Telegram</button>
  </div>
</div>

<script>
  // === Загрузка корзины ===
  let cart = JSON.parse(localStorage.getItem("tulpanCart") || "[]");

  function saveCart(){
    localStorage.setItem("tulpanCart", JSON.stringify(cart));
  }

  function updateCart(){
    const body = document.getElementById("cartBody");
    const totalEl = document.getElementById("cartTotal");

    if(cart.length === 0){
      body.innerHTML = "<tr><td colspan='4'>Корзина пуста.</td></tr>";
      totalEl.textContent = "0 ₽";
      return;
    }

    let total = 0;

    body.innerHTML = cart.map((item, index) => {
      const sum = item.price * item.qty;
      total += sum;

      return `
        <tr>
          <td>${item.name}</td>
          <td>${item.price} ₽</td>
          <td>
            <div class="qtyBox">
              <button onclick="changeQty(${index}, -20)">−</button>
              <input type="number" value="${item.qty}" readonly>
              <button onclick="changeQty(${index}, 20)">+</button>
            </div>
          </td>
          <td>${sum} ₽</td>
        </tr>
      `;
    }).join("");

    totalEl.textContent = total + " ₽";
  }

  function changeQty(i, delta){
    cart[i].qty += delta;
    if(cart[i].qty < 20) cart[i].qty = 20;
    saveCart();
    updateCart();
  }

  function clearCart(){
    localStorage.removeItem("tulpanCart");
    cart = [];
    updateCart();
  }

  function buildMessage(){
    if(cart.length === 0) return "Корзина пуста";

    let msg = "Заказ тюльпанов%0A-----------------%0A";
    cart.forEach(i=>{
      msg += `${i.name}: ${i.qty} шт = ${i.price*i.qty} ₽%0A`;
    });
    msg += "-----------------%0AИтого: " + document.getElementById("cartTotal").innerText;
    return msg;
  }

  function sendWhatsApp(){
    const msg = buildMessage();
    window.location.href = "https://wa.me/79148416115?text=" + msg;
  }

  function sendTelegram(){
    const msg = buildMessage();
    window.location.href = "tg://msg?text=" + msg;
  }

  updateCart();
</script>

</body>
</html>
