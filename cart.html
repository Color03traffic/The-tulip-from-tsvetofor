<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ö–æ—Ä–∑–∏–Ω–∞ ‚Äî –¢—é–ª—å–ø–∞–Ω03</title>

  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="favicon.png">
  <link rel="apple-touch-icon" sizes="180x180" href="icon.png">
  <link rel="shortcut icon" type="image/png" href="favicon.png">

  <style>
    :root{
      --bg:#f7b3d0;
      --white:#ffffff;
      --text:#222;
      --muted:#666;
      --brand:#e33474;
      --radius:18px;
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      background:var(--bg);
      font-family:system-ui,Roboto,Arial,sans-serif;
      color:var(--text);
    }
    a{text-decoration:none;color:inherit}
    .page{
      max-width:900px;
      margin:40px auto;
      padding:20px;
      background:var(--white);
      border-radius:var(--radius);
    }
    header{
      background:#fff;
      padding:12px 16px;
      border-radius:14px;
      border:1px solid #e5e7eb;
      margin-bottom:20px;
    }
    .header-row{
      display:flex;
      align-items:center;
      justify-content:space-between;
    }
    .logo{
      font-size:22px;
      font-weight:800;
    }
    nav{
      display:flex;
      gap:18px;
      font-weight:500;
    }
    nav a:hover{
      color:#d6286a;
    }
    h1{
      margin:10px 0;
      font-size:30px;
      font-weight:700;
    }
    .muted{
      color:var(--muted);
      font-size:14px;
    }
    table{
      width:100%;
      border-collapse:collapse;
      margin-top:20px;
    }
    th,td{
      padding:12px 10px;
      border-bottom:1px solid #ddd;
      text-align:left;
    }
    .qtyBox{
      display:flex;
      align-items:center;
      gap:6px;
    }
    .qtyBox button{
      width:32px;
      height:32px;
      border-radius:8px;
      border:1px solid #ccc;
      background:#fff;
      cursor:pointer;
      font-size:18px;
    }
    .qtyBox input{
      width:60px;
      text-align:center;
      padding:6px;
      border-radius:8px;
      border:1px solid #ccc;
    }
    .btn{
      padding:12px 20px;
      background:var(--brand);
      border-radius:10px;
      color:#fff;
      font-weight:600;
      border:none;
      cursor:pointer;
      display:inline-block;
      margin-top:20px;
      text-align:center;
    }
    .btn:hover{opacity:0.9;}
    .btnGreen{background:#25D366;}
    .btnBlue{background:#229ED9;}
    .btnSecondary{
      background:#fff;
      border:2px solid var(--brand);
      color:var(--brand);
      margin-right:12px;
    }
    .totalBox{
      margin-top:20px;
      font-size:22px;
      font-weight:700;
    }
    .form-block{
      margin-top:20px;
      padding:16px;
      border-radius:12px;
      border:1px solid #e5e7eb;
      background:#faf5f7;
    }
    .form-block h2{
      margin:0 0 10px;
      font-size:18px;
    }
    .form-row{
      display:flex;
      flex-direction:column;
      margin-bottom:10px;
    }
    .form-row label{
      font-size:14px;
      margin-bottom:4px;
    }
    .form-row input{
      padding:8px 10px;
      border-radius:8px;
      border:1px solid #d1d5db;
      font-size:14px;
    }
    .form-note{
      font-size:12px;
      color:var(--muted);
      margin-top:4px;
    }
    @media(max-width:600px){
      table,thead,tbody,tr,td,th{display:block;}
      td{border:none;}
      tr{margin-bottom:20px;border-bottom:1px solid #ddd;padding-bottom:10px;}
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div class="header-row">
        <div class="logo">üå∑ –¢—é–ª—å–ø–∞–Ω03</div>
        <nav>
          <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
          <a href="catalog.html">–ö–∞—Ç–∞–ª–æ–≥</a>
          <a href="contacts.html">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
        </nav>
      </div>
    </header>

    <h1>–ö–æ—Ä–∑–∏–Ω–∞</h1>
    <p class="muted">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—Ä–∞—Ç–Ω–æ 20 —à—Ç. –ú–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –≤—Ä—É—á–Ω—É—é –∏–ª–∏ –∫–Ω–æ–ø–∫–∞–º–∏.</p>

    <table id="cartTable">
      <thead>
        <tr>
          <th>–¢–æ–≤–∞—Ä</th>
          <th>–¶–µ–Ω–∞ –∑–∞ —à—Ç.</th>
          <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
          <th>–°—É–º–º–∞</th>
        </tr>
      </thead>
      <tbody id="cartBody"></tbody>
    </table>

    <div class="totalBox">
      –ò—Ç–æ–≥–æ: <span id="cartTotal">0 ‚ÇΩ</span>
    </div>

    <div class="form-block">
      <h2>–î–∞–Ω–Ω—ã–µ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è</h2>
      <div class="form-row">
        <label>–§–ò–û *</label>
        <input id="clientName" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á">
      </div>
      <div class="form-row">
        <label>–¢–µ–ª–µ—Ñ–æ–Ω *</label>
        <input id="clientPhone" placeholder="+7 9.. .. ..">
        <div class="form-note">–ë–µ–∑ —ç—Ç–∏—Ö –¥–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑ –Ω–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è.</div>
      </div>
    </div>

    <div style="margin-top:25px;">
      <a href="catalog.html" class="btn btnSecondary">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥</a>
      <button class="btn" onclick="clearCart()">–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É</button>
    </div>

    <div style="margin-top:25px;">
      <button class="btn btnGreen" onclick="sendWhatsApp()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ WhatsApp</button>
      <button class="btn btnBlue"  onclick="sendTelegram()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram</button>
    </div>
  </div>

  <script>
    /* === –ù–û–í–ê–Ø –ì–†–ê–î–ê–¶–ò–Ø –¶–ï–ù (3 –¢–ò–ü–ê –¢–Æ–õ–¨–ü–ê–ù–û–í) === */

    // 1) –í—Å–µ —Å–æ—Ä—Ç–∞, –∫—Ä–æ–º–µ –º–∞—Ö—Ä–æ–≤—ã—Ö –∏ –º–∏–∫—Å ‚Äî "smooth"
    const tiersSmooth = [
      {min: 20, max: 499,    price: 109},
      {min: 500, max: 999,   price: 98},
      {min: 1000, max: 1999, price: 90},
      {min: 2000, max: 2999, price: 89},
      {min: 3000, max: 4999, price: 88},
      {min: 5000, max: 9999, price: 87},
      {min: 10000, max: 49999,price: 86},
      {min: 50000, max: 99999,price: 85}
    ];

    // 2) –ú–∞—Ö—Ä–æ–≤—ã–µ ‚Äî "terry"
    const tiersTerry = [
      {min: 20, max: 499,    price: 119},
      {min: 500, max: 999,   price: 108},
      {min: 1000, max: 1999, price: 100},
      {min: 2000, max: 2999, price: 99},
      {min: 3000, max: 4999, price: 98},
      {min: 5000, max: 9999, price: 97},
      {min: 10000, max: 49999,price: 96},
      {min: 50000, max: 99999,price: 95}
    ];

    // 3) –ú–∏–∫—Å ‚Äî "mix"
    const tiersMix = [
      {min: 20, max: 499,    price: 108},
      {min: 500, max: 999,   price: 97},
      {min: 1000, max: 1999, price: 89},
      {min: 2000, max: 2999, price: 88},
      {min: 3000, max: 4999, price: 87},
      {min: 5000, max: 9999, price: 86},
      {min: 10000, max: 49999,price: 85},
      {min: 50000, max: 100000,price: 84}
    ];

    function getPriceFromTiers(tiers, totalQty){
      for(const t of tiers){
        if(totalQty >= t.min && totalQty <= t.max) return t.price;
      }
      return tiers[tiers.length - 1].price;
    }

    function getUnitPrices(){
      const totalQty = cart.reduce((s,i)=>s + i.qty, 0);
      if(totalQty === 0) return {smooth:0, terry:0, mix:0};
      return {
        smooth: getPriceFromTiers(tiersSmooth, totalQty),
        terry:  getPriceFromTiers(tiersTerry,  totalQty),
        mix:    getPriceFromTiers(tiersMix,    totalQty)
      };
    }

    /* === –ö–û–†–ó–ò–ù–ê === */
    let cart = JSON.parse(localStorage.getItem("tulpan03_cart") || "[]");

    function saveCart(){
      localStorage.setItem("tulpan03_cart", JSON.stringify(cart));
    }

    function normalizeQty(v){
      v = parseInt(v,10);
      if(isNaN(v) || v < 20) v = 20;
      return Math.round(v/20)*20;
    }

    function updateCart(){
      const body    = document.getElementById("cartBody");
      const totalEl = document.getElementById("cartTotal");

      if(cart.length === 0){
        body.innerHTML = "<tr><td colspan='4'>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞.</td></tr>";
        totalEl.textContent = "0 ‚ÇΩ";
        return;
      }

      const prices = getUnitPrices();
      let total = 0;

      body.innerHTML = cart.map((item, index)=>{
        let unitPrice = 0;
        if(item.type === "terry")      unitPrice = prices.terry;
        else if(item.type === "mix")   unitPrice = prices.mix;
        else                           unitPrice = prices.smooth; // –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî –æ–±—ã—á–Ω—ã–µ

        const sum = unitPrice * item.qty;
        total += sum;

        return `
          <tr>
            <td>${item.name}</td>
            <td>${unitPrice} ‚ÇΩ</td>
            <td>
              <div class="qtyBox">
                <button onclick="changeQty(${index}, -20)">‚àí</button>
                <input value="${item.qty}" onchange="manualQtyChange(${index}, this.value)">
                <button onclick="changeQty(${index}, 20)">+</button>
              </div>
            </td>
            <td>${sum} ‚ÇΩ</td>
          </tr>
        `;
      }).join("");

      totalEl.textContent = total + " ‚ÇΩ";
    }

    function changeQty(i, delta){
      cart[i].qty = normalizeQty(cart[i].qty + delta);
      saveCart();
      updateCart();
    }

    function manualQtyChange(i,v){
      cart[i].qty = normalizeQty(v);
      saveCart();
      updateCart();
    }

    function clearCart(){
      localStorage.removeItem("tulpan03_cart");
      cart = [];
      updateCart();
      document.getElementById("clientName").value = "";
      document.getElementById("clientPhone").value = "";
    }

    /* === –ü–†–û–í–ï–†–ö–ê –î–ê–ù–ù–´–• === */
    function validateClient(){
      const name  = document.getElementById("clientName").value.trim();
      const phone = document.getElementById("clientPhone").value.trim();

      if(cart.length === 0){
        alert("–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞");
        return false;
      }
      if(!name){
        alert("–í–≤–µ–¥–∏—Ç–µ –§–ò–û");
        return false;
      }
      if(!phone){
        alert("–í–≤–µ–¥–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω");
        return false;
      }
      return {name, phone};
    }

    /* === –§–û–†–ú–ò–†–û–í–ê–ù–ò–ï –¢–ï–ö–°–¢–ê === */
    function buildMessage(){
      const client = validateClient();
      if(!client) return null;

      const prices = getUnitPrices();
      let total = 0;

      let msg = "–ó–∞–∫–∞–∑%0A-----------------%0A";
      msg += "–§–ò–û: " + encodeURIComponent(client.name) + "%0A";
      msg += "–¢–µ–ª–µ—Ñ–æ–Ω: " + encodeURIComponent(client.phone) + "%0A";
      msg += "-----------------%0A";

      cart.forEach(i=>{
        let price = 0;
        if(i.type === "terry")      price = prices.terry;
        else if(i.type === "mix")   price = prices.mix;
        else                        price = prices.smooth;

        const sum = price * i.qty;
        total += sum;

        msg += `${encodeURIComponent(i.name)}%3A%20${i.qty}%20—à—Ç%20√ó%20${price}%20=%20${sum}%0A`;
      });

      msg += "-----------------%0A–ò—Ç–æ–≥–æ: " + total + " ‚ÇΩ";
      return msg;
    }

    /* === WhatsApp === */
    function sendWhatsApp(){
      const msg = buildMessage();
      if(!msg) return;
      window.location.href = "https://wa.me/79148416115?text=" + msg;
    }

    /* === Telegram === */
    function sendTelegram(){
      const msg = buildMessage();
      if(!msg) return;
      window.location.href = "https://t.me/tulpan03?text=" + msg;
    }

    updateCart();
  </script>
</body>
</html>

