<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>–ö–æ—Ä–∑–∏–Ω–∞ ‚Äî –¢—é–ª—å–ø–∞–Ω03</title>
  <style>
    :root{
      --bg:#f7c1d9;
      --card:#ffffff;
      --text:#111;
      --muted:#666;
      --brand:#E33478;
      --radius:16px;
      --stroke:#e5e7eb;
    }

    *{box-sizing:border-box;}

    body{
      margin:0;
      font-family:system-ui,-apple-system,Inter,sans-serif;
      background:var(--bg);
      color:var(--text);
    }

    .container{
      max-width:1100px;
      margin:0 auto;
      padding:16px;
    }

    header{
      margin-bottom:10px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }

    .logo{
      font-size:22px;
      font-weight:800;
    }

    .back-btn{
      display:inline-block;
      background:var(--brand);
      color:#fff;
      padding:8px 14px;
      border-radius:12px;
      text-decoration:none;
      font-weight:600;
      font-size:14px;
    }

    h1{
      margin:10px 0 16px;
      text-align:left;
    }

    .card{
      background:var(--card);
      border-radius:var(--radius);
      padding:20px;
      border:1px solid var(--stroke);
      box-shadow:0 4px 12px rgba(0,0,0,.06);
      margin-bottom:20px;
    }

    table{
      width:100%;
      border-collapse:collapse;
      font-size:14px;
    }

    th, td{
      padding:8px;
      border-bottom:1px solid var(--stroke);
      text-align:left;
    }

    th:last-child, td:last-child{
      text-align:right;
    }

    .empty{
      padding:10px 0;
      color:var(--muted);
    }

    .total{
      margin-top:10px;
      font-size:18px;
      font-weight:700;
    }

    .btn{
      padding:10px 16px;
      border-radius:12px;
      border:none;
      cursor:pointer;
      font-weight:600;
      color:#fff;
      margin-right:10px;
      font-size:14px;
    }

    .whatsapp{background:#25D366;}
    .telegram{background:#229ED9;}
    .clear-btn{
      background:#ff4d4d;
    }

    .qty{
      width:80px;
      padding:6px;
      border-radius:10px;
      border:1px solid #ccc;
      text-align:center;
      font-size:14px;
    }

    .qty.invalid{
      border:2px solid red !important;
      background:#ffe6e6 !important;
    }

    @media(max-width:768px){
      header{
        flex-direction:column;
        align-items:flex-start;
      }
      table{
        font-size:13px;
      }
    }
  </style>
</head>
<body>

<div class="container">

  <header>
    <div class="logo">üå∑ –¢—é–ª—å–ø–∞–Ω03</div>
    <a href="catalog.html" class="back-btn">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥</a>
  </header>

  <h1>–ö–æ—Ä–∑–∏–Ω–∞</h1>

  <div class="card">
    <table id="cartTable">
      <thead>
        <tr>
          <th>–¢–æ–≤–∞—Ä</th>
          <th>–¢–∏–ø</th>
          <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</th>
          <th>–¶–µ–Ω–∞ –∑–∞ —à—Ç</th>
          <th>–°—É–º–º–∞</th>
          <th></th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div id="cartEmpty" class="empty" style="display:none;">
      –ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞. –î–æ–±–∞–≤—å—Ç–µ —Ç—é–ª—å–ø–∞–Ω—ã –≤ –∫–∞—Ç–∞–ª–æ–≥–µ.
    </div>

    <div class="total">–ò—Ç–æ–≥–æ: <span id="totalPrice">0 ‚ÇΩ</span></div>

    <div style="margin-top:12px;">
      <button class="btn whatsapp" type="button" onclick="sendWhatsApp()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ WhatsApp</button>
      <button class="btn telegram" type="button" onclick="sendTelegram()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram</button>
      <button class="btn clear-btn" type="button" onclick="clearCart()">–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É</button>
    </div>
  </div>

</div>

<script>
  const CART_KEY = 'cart'; // —Ç–æ—Ç –∂–µ –∫–ª—é—á, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–∞—Ç–∞–ª–æ–≥

  function getCart(){
    return JSON.parse(localStorage.getItem(CART_KEY) || '{}');
  }

  function saveCart(cart){
    localStorage.setItem(CART_KEY, JSON.stringify(cart));
  }

  function format(num){
    return num.toLocaleString('ru-RU');
  }

  function loadCart(){
    const cart = getCart();
    const tbody = document.querySelector('#cartTable tbody');
    const empty = document.getElementById('cartEmpty');
    const totalEl = document.getElementById('totalPrice');

    tbody.innerHTML = '';
    let total = 0;
    let hasItems = false;

    for (const id in cart){
      const item = cart[id];
      hasItems = true;
      const sum = item.price * item.qty;
      total += sum;

      tbody.insertAdjacentHTML('beforeend', `
        <tr>
          <td>${item.name}</td>
          <td>${item.type || ''}</td>
          <td>
            <input
              type="number"
              class="qty"
              min="20"
              step="20"
              value="${item.qty}"
              oninput="highlightInvalid(this)"
              onblur="updateQty('${id}', this)"
            >
          </td>
          <td>${format(item.price)} ‚ÇΩ</td>
          <td>${format(sum)} ‚ÇΩ</td>
          <td><a href="#" onclick="removeItem('${id}');return false;">–£–¥–∞–ª–∏—Ç—å</a></td>
        </tr>
      `);
    }

    if (!hasItems){
      empty.style.display = 'block';
    } else {
      empty.style.display = 'none';
    }

    totalEl.textContent = format(total) + ' ‚ÇΩ';
  }

  function highlightInvalid(input){
    let v = parseInt(input.value);
    if (!v || v < 20 || v % 20 !== 0){
      input.classList.add('invalid');
    } else {
      input.classList.remove('invalid');
    }
  }

  function updateQty(id, input){
    let q = parseInt(input.value);

    // –ú–∏–Ω–∏–º—É–º 20
    if (!q || q < 20) q = 20;

    // –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–æ –±–ª–∏–∂–∞–π—à–∏—Ö 20
    if (q % 20 !== 0){
      q = Math.round(q / 20) * 20;
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –ø–æ–ª–µ
    input.value = q;
    input.classList.remove('invalid');

    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ—Ä–∑–∏–Ω—É
    const cart = getCart();
    if (cart[id]){
      cart[id].qty = q;
      saveCart(cart);
    }

    loadCart();
  }

  function removeItem(id){
    const cart = getCart();
    delete cart[id];
    saveCart(cart);
    loadCart();
  }

  function clearCart(){
    localStorage.removeItem(CART_KEY);
    loadCart();
  }

  function buildMessage(){
    const cart = getCart();
    let text = '–ó–∞–∫–∞–∑ —Ç—é–ª—å–ø–∞–Ω–æ–≤:\n';
    let total = 0;

    for (const id in cart){
      const item = cart[id];
      const sum = item.price * item.qty;
      total += sum;
      text += `${item.name} ‚Äî ${item.qty} —à—Ç √ó ${item.price} ‚ÇΩ = ${sum} ‚ÇΩ\n`;
    }

    text += `\n–ò—Ç–æ–≥–æ: ${total} ‚ÇΩ`;
    return text;
  }

  function sendWhatsApp(){
    const cart = getCart();
    if (!Object.keys(cart).length){
      alert('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞');
      return;
    }
    const msg = buildMessage();
    const url = 'https://wa.me/79148416115?text=' + encodeURIComponent(msg);
    window.open(url, '_blank');
  }

  function sendTelegram(){
    const cart = getCart();
    if (!Object.keys(cart).length){
      alert('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞');
      return;
    }
    const msg = buildMessage();
    // –µ—Å–ª–∏ —É —Ç–µ–±—è –µ—Å—Ç—å —é–∑–µ—Ä–Ω–µ–π–º/–±–æ—Ç, –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å —Å—Å—ã–ª–∫—É
    const url = 'https://t.me/share/url?url=&text=' + encodeURIComponent(msg);
    window.open(url, '_blank');
  }

  // —Å—Ç–∞—Ä—Ç
  loadCart();
</script>

</body>
</html>
